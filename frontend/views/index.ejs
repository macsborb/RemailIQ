<!doctype html>
<html lang="en">
<head>
  <title>ProspectAI</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v2.1.9/css/unicons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    .navbar-custom {
      background-color: #1f2029;
      border-bottom: 1px solid #444;
    }
    .navbar-custom .nav-link, .navbar-custom .navbar-brand {
      color: #ffeba7;
    }
    .navbar-custom .nav-link:hover {
      color: #c4c3ca;
    }
    .section-intro {
      padding: 100px 0;
      text-align: center;
      color: #ffeba7;
    }
    .section-intro h1 {
      font-size: 48px;
      font-weight: 700;
    }
    .section-intro p {
      font-size: 18px;
      max-width: 700px;
      margin: 20px auto;
    }
    .intro-image {
      max-width: 450px;
      margin-top: 40px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      border: 2px solid #ffeba7;
    }
    .features {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2rem;
      padding: 60px 0;
    }
    .feature {
      background-color: #2b2e38;
      border-radius: 12px;
      padding: 30px;
      color: #ffeba7;
      max-width: 300px;
      text-align: center;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .feature i {
      font-size: 36px;
      margin-bottom: 15px;
      color: #ffeba7;
    }
    .popup-success {
      position: relative;
      top: 70px; /* ajusté pour être sous la navbar */
      width: 100%;
      background-color: #28a745;
      color: white;
      padding: 20px;
      text-align: center;
      font-weight: bold;
      z-index: 999;
      display: none;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    .popup-success.show {
      display: block;
      opacity: 1;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#">ProspectAI</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item"><a class="nav-link" href="#about">À propos</a></li>
          <li class="nav-item"><a class="nav-link" href="#features">Fonctionnalités</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
        </ul>
        <a href="#auth" class="btn btn-outline-light">Se connecter</a>
      </div>
    </div>
  </nav>
 

  <section class="section-intro" id="about">
    <div class="container">
      <h1>Révolutionne ta prospection B2B</h1>
      <p>ProspectAI est un assistant intelligent qui automatise la création de mails de prospection d'entreprise à entreprise. Moins de temps perdu, plus d'efficacité commerciale.</p>
      <img src="/img/ai-email.png" alt="Illustration AI" class="img-fluid intro-image">
    </div>
  </section>
  <section class="features" id="features">
    <div class="feature">
      <i class="uil uil-envelope-alt"></i>
      <h4>Emails contextualisés</h4>
      <p>Chaque mail est généré en fonction du profil de l'entreprise ciblée pour maximiser l'engagement.</p>
    </div>
    <div class="feature">
      <i class="uil uil-brain"></i>
      <h4>IA performante</h4>
      <p>Notre moteur analyse les entreprises et génère des messages convaincants et personnalisés.</p>
    </div>
    <div class="feature">
      <i class="uil uil-clock"></i>
      <h4>Gain de temps</h4>
      <p>Réduisez le temps passé par vos commerciaux à rédiger des mails grâce à l’automatisation intelligente.</p>
    </div>
  </section>

  <div id="auth">
    <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger mt-4"><%= error %></div>
    <% } %>
    <div id="success-popup" class="popup-success">
      ✅ Votre compte a bien été créé. Vous pouvez maintenant vous connecter.
    </div>

    <div class="section">
		<div class="container">
			<div class="row full-height justify-content-center">
				<div class="col-12 text-center align-self-center py-5">
					<div class="section pb-5 pt-5 pt-sm-2 text-center">
						<h6 class="mb-0 pb-3"><span>Log In </span><span>Sign Up</span></h6>
			          	<input class="checkbox" type="checkbox" id="reg-log" name="reg-log"/>
			          	<label for="reg-log"></label>
						<div class="card-3d-wrap mx-auto">
							<div class="card-3d-wrapper">
								<div class="card-front">
									<div class="center-wrap">
										<div class="section text-center">
											<h4 class="mb-4 pb-3">Log In</h4>
											<form method="post" action="/login">
												<div class="form-group">
													<input type="email" name="email" class="form-style" placeholder="Email" required>
													<i class="input-icon uil uil-at"></i>
												</div>	
												<div class="form-group mt-2">
													<input type="password" name="password" class="form-style" placeholder="Password" required>
													<i class="input-icon uil uil-lock-alt"></i>
												</div>
												<button class="btn mt-4">Login</button>
											</form>
										</div>
			      					</div>
			      				</div>
								<div class="card-back">
									<div class="center-wrap">
										<div class="section text-center">
											<h4 class="mb-3 pb-3">Sign Up</h4>
											<form id="register-form" method="post" action="/register">
                        <div id="step1">
                          <div class="form-group">
                            <input type="email" id="reg-email" name="email" class="form-style" placeholder="Email" required>
                            <i class="input-icon uil uil-at"></i>
                          </div>
                          <div class="form-group mt-2">
                            <input type="password" id="reg-password" name="password" class="form-style" placeholder="Password" required>
                            <i class="input-icon uil uil-lock-alt"></i>
                          </div>
                          <div class="form-group mt-2">
                            <input type="password" id="reg-confirm" name="confirm_password" class="form-style" placeholder="Confirmez le mot de passe" required>
                            <i class="input-icon uil uil-lock-alt"></i>
                          </div>
                          <div class="form-group mt-3">
                            <button type="button" class="btn btn-warning" onclick="goToStep2()">Suivant</button>
                          </div>
                        </div>

                        <div id="step2" style="display: none;">
                          <p class="text-light">Un code de vérification a été envoyé à <span id="confirm-email" class="font-weight-bold"></span>. Veuillez le saisir ci-dessous :</p>
                          <div class="form-group mt-3">
                            <input type="text" name="email_code" class="form-style" placeholder="Code reçu par email" required>
                            <i class="input-icon uil uil-key-skeleton"></i>
                          </div>
                          <div class="form-group mt-3">
                            <button type="button" class="btn btn-success" onclick="submitRegister()">Register</button>
                          </div>
                        </div>
                      </form>
										</div>
			      					</div>
			      				</div>
			      			</div>
			      		</div>
			      	</div>
		      	</div>
	      	</div>
	    </div>
    </div>
	</div>
  </div>
  <script>
    function submitRegister() {
      const email = document.querySelector("#reg-email").value
      const password = document.querySelector("#reg-password").value
      const confirm_password = document.querySelector("#reg-confirm").value
      const code = document.querySelector('input[name="email_code"]').value

      fetch('/verify-code', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, code })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          // Submit real form to create account
          const form = document.getElementById('register-form')

          // On ajoute dynamiquement les inputs masqués nécessaires
          const hidden1 = document.createElement('input')
          hidden1.type = 'hidden'
          hidden1.name = 'email'
          hidden1.value = email
          form.appendChild(hidden1)

          const hidden2 = document.createElement('input')
          hidden2.type = 'hidden'
          hidden2.name = 'password'
          hidden2.value = password
          form.appendChild(hidden2)

          const hidden3 = document.createElement('input')
          hidden3.type = 'hidden'
          hidden3.name = 'confirm_password'
          hidden3.value = confirm_password
          form.appendChild(hidden3)

          const hidden4 = document.createElement('input')
          hidden4.type = 'hidden'
          hidden4.name = 'email_code'
          hidden4.value = code
          form.appendChild(hidden4)

          fetch('/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email,
              password,
              confirm_password,
              email_code: code
            })
          })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              const popup = document.getElementById('success-popup')
              popup.classList.add('show')
              popup.style.display = 'block'

              popup.scrollIntoView({ behavior: 'smooth', block: 'center' })
              document.getElementById('step2').style.display = 'none'

              document.getElementById("register-form").reset()
              document.getElementById("step1").style.display = "block"

              setTimeout(() => {
                popup.classList.remove('show')
                popup.style.display = 'none'
              }, 5000)
            }
            else {
              alert(data.error || 'Erreur lors de l’enregistrement.')
            }
          })
        } else {
          alert(data.error || 'Code incorrect.')
        }
      })
      .catch(() => alert("Erreur réseau lors de la vérification du code."))
    }
    function goToStep2() {
      const email = document.querySelector("#reg-email").value
      const password = document.querySelector("#reg-password").value
      const confirm = document.querySelector("#reg-confirm").value

      if (!email || !password || !confirm) return alert("Veuillez remplir tous les champs")
      if (password !== confirm) return alert("Les mots de passe ne correspondent pas")

      // Étape 1 : vérifie si email déjà utilisé
      fetch('/check-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      })
      .then(res => res.json())
      .then(data => {
        if (data.exists) {
          return alert("Cette adresse e-mail est déjà utilisée.")
        }

        // Étape 2 : envoie du code
        return fetch('/send-code', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        })
      })
      .then(res => res?.json?.())
      .then(data => {
        if (data?.success) {
          document.getElementById("step1").style.display = "none"
          document.getElementById("step2").style.display = "block"
          document.getElementById("confirm-email").innerText = email
        } else if (data?.error) {
          alert(data.error)
        }
      })
      .catch(() => alert("Erreur réseau"))
    }

    function sendVerificationCode() {
      const email = document.querySelector("#signup-mail")?.value
      if (!email) return alert("Veuillez entrer une adresse email")

      fetch('/send-code', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Code envoyé par email.')
        } else {
          alert('Erreur lors de l’envoi du code.')
        }
      })
      .catch(() => alert('Erreur réseau.'))
    }
  </script>

</body>
</html>

